@model Mittagessen.Web.Models.EnrollmentModel
           
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    $(function () {
        $(".enroll-button").click(function () {
            var enrollButton = $(this);
            enrollButton.attr("disabled", "disabled");
            $.post('@Url.Action("EnrollUser")', { lunchId: enrollButton.attr("lunch-id") }, function (result) {
                if (result.success) {
                    enrollButton.replaceWith("<div class='enrolled-msg'>Angemeldet</div>");
                }
                else {
                    enrollButton.replaceWith("<div class='disenrolled-msg'>Voll</div>");
                }
            });
        });

        $(".disenroll-button").click(function () {
            var disenrollButton = $(this);
            disenrollButton.attr("disabled", "disabled");
            $.post('@Url.Action("DisenrollUser")', { lunchId: disenrollButton.attr("lunch-id") }, function () {
                disenrollButton.replaceWith("<div class='disenrolled-msg'>Abgemeldet</div>");
            });
        });
    });       
</script>

<h2>Anmeldung</h2>

@foreach (var lunch in Model.Lunches)
{    
    <div class="meal">
        <div style="margin-left:auto;margin-right:auto;width:7em">
        @if (@lunch.NumberOfEnrollments >= lunch.NumberOfPortions)
        {
            <div class='termin-full-msg'>Voll</div>
        }
        else if (Model.EnrolledByUser(lunch))
        {
            <input lunch-id="@lunch.Id" type='button' value='Abmelden' class='btn btn-danger disenroll-button' />
        }
        else
        {
            <input lunch-id="@lunch.Id" type='button' value='Anmelden' class='btn btn-primary enroll-button' />
        }
        </div>
        <div>@lunch.LunchDate</div>
        <div class='meal-details' meal-id="@lunch.CookedMealId">
            <img alt="@lunch.CookedMeal.Name" src="@lunch.CookedMeal.ImageName"  />
            <span>@lunch.CookedMeal.Name</span>
        </div>
        <div>
            <span>Portionen: </span><span>@lunch.NumberOfPortions</span>
        </div>
        <div>
            <span>Angemeldete: </span><span>@lunch.NumberOfEnrollments</span>
        </div>
    </div>   
}
